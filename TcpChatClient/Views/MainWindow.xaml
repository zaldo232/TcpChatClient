<Window x:Class="TcpChatClient.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:TcpChatClient.ViewModels"
        xmlns:conv="clr-namespace:TcpChatClient.Converters"
        xmlns:helpers="clr-namespace:TcpChatClient.Helpers"
        Title="TCP 채팅 클라이언트" Height="600" Width="850"
        WindowStartupLocation="CenterScreen"
        FontFamily="Segoe UI" Background="#FAFAFA">

    <Window.Resources>
        <conv:BoolToAlignmentConverter x:Key="BoolToAlign"/>
        <conv:BoolToBrushConverter x:Key="BoolToBrush"/>
        <conv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>

        <DataTemplate x:Key="TextTemplate">
            <Grid Margin="4">
                <Border Background="{Binding IsMine, Converter={StaticResource BoolToBrush}}"
                        CornerRadius="12" Padding="10,6"
                        HorizontalAlignment="{Binding IsMine, Converter={StaticResource BoolToAlign}}"
                        MaxWidth="400">
                    <TextBlock Text="{Binding Display}"
                               TextWrapping="Wrap"
                               FontSize="14"
                               LineStackingStrategy="BlockLineHeight"
                               LineHeight="18"
                               Margin="0"/>
                </Border>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="FileTemplate">
            <Grid Margin="4">
                <Border Background="{Binding IsMine, Converter={StaticResource BoolToBrush}}"
                        CornerRadius="12" Padding="10,6"
                        HorizontalAlignment="{Binding IsMine, Converter={StaticResource BoolToAlign}}"
                        MaxWidth="400">
                    <Button Content="{Binding Display}" Padding="4"
                            Click="FileDownload_Click"
                            Tag="{Binding}" Background="Transparent" BorderThickness="0"
                            HorizontalAlignment="Left" Foreground="DarkBlue"
                            Cursor="Hand"
                            Visibility="{Binding IsFileMessage, Converter={StaticResource BoolToVisibilityConverter}}"/>
                </Border>
            </Grid>
        </DataTemplate>

        <helpers:FileMessageTemplateSelector x:Key="MessageTemplateSelector"
                                             TextTemplate="{StaticResource TextTemplate}"
                                             FileTemplate="{StaticResource FileTemplate}"/>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="180"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- 메시지 검색창 -->
            <RowDefinition Height="*"/>
            <!-- 채팅창 -->
            <RowDefinition Height="Auto"/>
            <!-- 입력창 -->
        </Grid.RowDefinitions>

        <!-- 유저 목록 -->
        <StackPanel Grid.Column="0" Grid.RowSpan="3">
            <TextBlock Text="유저 목록" FontWeight="Bold" FontSize="16" Margin="5"/>

            <TextBox x:Name="UserSearchBox"
                     Text="유저 검색"
                     Foreground="Gray"
                     TextChanged="UserSearchBox_TextChanged"
                     GotFocus="ClearPlaceholder"
                     LostFocus="RestorePlaceholder"
                     Margin="5,0" Height="26" FontSize="13"/>

            <StackPanel Orientation="Horizontal" Margin="5,5,5,10">
                <Button Content="전체" Width="70" Margin="0,0,5,0"
                        Click="ShowAllUsers_Click" Background="#D6EAF8"/>
                <Button Content="접속중" Width="70"
                        Click="ShowOnlineUsers_Click" Background="#ABEBC6"/>
            </StackPanel>

            <ListBox ItemsSource="{Binding FilteredUserList}"
                     SelectedItem="{Binding SelectedUser}"
                     FontSize="14" Margin="5"
                     BorderBrush="#DDD" BorderThickness="1"/>
        </StackPanel>

        <!-- 메시지 검색창 -->
        <TextBox x:Name="MessageSearchBox"
                 Grid.Column="1" Grid.Row="0"
                 Text="메시지 검색"
                 Foreground="Gray"
                 TextChanged="MessageSearchBox_TextChanged"
                 GotFocus="ClearPlaceholder"
                 LostFocus="RestorePlaceholder"
                 Margin="0,0,0,10" Height="26" FontSize="13"/>

        <!-- 채팅 메시지 -->
        <ScrollViewer x:Name="scrollViewer" Grid.Column="1" Grid.Row="1"
                      VerticalScrollBarVisibility="Auto" Margin="5,0,0,0">
            <ItemsControl ItemsSource="{Binding FilteredMessages}"
                          ItemTemplateSelector="{StaticResource MessageTemplateSelector}"/>
        </ScrollViewer>

        <!-- 입력창 -->
        <Grid Grid.Row="2" Grid.Column="1" Margin="5,10,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBox x:Name="InputBox"
                     Grid.Column="0" Height="34"
                     Margin="0,0,5,0"
                     Text="{Binding Input, UpdateSourceTrigger=PropertyChanged}"
                     FontSize="14" Padding="5"
                     AllowDrop="True"
                     PreviewDragOver="InputBox_PreviewDragOver"
                     Drop="InputBox_Drop"/>

            <Button Grid.Column="1" Content="보내기"
                    Command="{Binding SendCommand}"
                    Margin="0,0,5,0" Padding="15,0"
                    Height="34" MinWidth="80" Background="#5DADE2" Foreground="White"/>

            <Button Grid.Column="2" Content="파일"
                    Command="{Binding SendFileCommand}"
                    Padding="15,0"
                    Height="34" MinWidth="80" Background="#A569BD" Foreground="White"/>
        </Grid>
    </Grid>
</Window>
